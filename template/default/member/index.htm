{template 'header2','member'}
<style>
    #openPhoneNumber span {
        height: 34px;
        line-height: 34px;
    }
    #openPhoneNumber .Validform_wrong {
        float: right;
        color: #c31e2a;
    }
    #openPhoneNumber .Validform_right {
        float:right;
    }
    #openPhoneNumber {
        padding: 0 54px;
    }
    #openPhoneNumber input[type="text"] {
        width: 222px;
        float: left;
        height: 34px;
    }
    #openPhoneNumber .getCode {
        float: left;
        width: 98px;
        height: 37px;
        color: #666;
        cursor: pointer;
        margin-left: 16px;
        border-radius: 3px;
        border: 1px solid #e2e2e2;
        background-color: #f9f9f9;
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#f9f9f9');
        -ms-filter: "progid: DXImageTransform.Microsoft.gradient(startColorstr = '#ffffff', endColorstr = '#f9f9f9')";
        background-image: -moz-linear-gradient(top, #ffffff, #f9f9f9);
        background-image: -ms-linear-gradient(top, #ffffff, #f9f9f9);
        background-image: -o-linear-gradient(top, #ffffff, #f9f9f9);
        background-image: -webkit-gradient(linear, center top, center bottom, from(#ffffff), to(#f9f9f9));
        background-image: -webkit-linear-gradient(top, #ffffff, #f9f9f9);
        background-image: linear-gradient(top, #ffffff, #f9f9f9);
    }
    #openPhoneNumber input[type="submit"] {
        width: 234px;
        height: 34px;
        background-color: #e20006;
        border-radius: 2px;
        text-align: center;
        line-height: 34px;
        color: #fff;
        border: none;
        cursor: pointer;
    }
</style>
<section class="m-c-main">
    <section class="home clearfix">
        {template 'left','member'}
        <section class="right-main fl">
            <section class="mh-evaluate mh-info">
                <h2 class="mh-title">个人资料 <span class="orange o-tip"><img src="{DT_SKIN_TWO}images/wycms/lamp.png" alt="">完善个人资料</span></h2>
                <header class="info-title">真实身份完善<i class="tip orange"></i><span class="orange">（提交后不能修改）</span></header>
                <div class="info-list">
                    <label class="name">真实姓名 :</label><span class="content">{$info['truename']}</span>
                </div>
                <form id="idcardfrom" method="post" action="/ajax.php?action=member&moduleid=2&job=saveinfo&field=idcard" >
                    <div class="info-list clearfix">
                        <label class="name fl">身份证号 :</label>
                        {if $info['idcard']}
                            <span class="content">{substr_replace($info['idcard'],'**************',2,(strlen($info['idcard'])-4))}</span>
                        {else}
                            <input name="idcard" datatype="is_idcard" type="text" placeholder="请填写你的身份证号" errormsg="请填写正确的身份证号！" class="fl">
                            <input  type="submit" value="保存" class="info-sub white fl">
                        {/if}
                    </div>
                </form>
                <form id="genderfrom" method="post" action="/ajax.php?action=member&moduleid=2&job=saveinfo&field=gender" >
                    <div class="info-list clearfix">
                        <span class="fl"><label class="name">性<span class="blank"></span>别 :</label></span>
                        {if $info['gender']}
                        <span class="content">{if $info['gender']==1}男{else}女{/if}</span>
                        {else}
                        <span class="fl" style="margin-right:5px;"><input name="gender"  type="radio" value="1" checked >男</span>
                        <span class="fl"><input name="gender"  type="radio" value="2">女</span>
                        <input  type="submit" value="保存" class="info-sub white fl">
                        {/if}
                    </div>
                </form>

                <div class="info-list clearfix">
                    <label class="name fl">联系电话 :</label>
                    <span id="mobile1_show" class="fl">{substr_replace($info['mobile'],'****',3,4)}</span>
                    <input id="info-sub_m2" type="submit" onclick="openPhoneNumber('')" value="修改" class="info-sub white fl">
                </div>

                <div id="emailform23" class="info-list clearfix">
                    <label class="name fl">联系邮箱 :</label>
                    <span>{$info['email']}</span>
                    <input type="submit" onclick="emailform()" value="修改" class="info-sub-x white">
                </div>
                <form id="emailform" style="display:none" method="post" action="/ajax.php?action=member&moduleid=2&job=saveinfo&field=email" class="info-from3">
                    <div class="info-list clearfix">
                        <label class="name fl">联系邮箱 :</label>
                        <input name="email" id="email" datatype="e" type="text" placeholder="请填写你的邮箱" errormsg="请填写正确的邮箱格式！" class="fl">
                        <input type="submit" value="保存" class="info-sub white fl">
                    </div>
                </form>
                <div id="area1" class="info-list clearfix">
                    <label class="name">通讯地址 :</label>
                    <span>{area_pos($info['areaid'],'')}{$info['address']}</span>
                    <input num="3" onclick="area()" type="button" value="修改地址" class="info-sub-x white">
                </div>
                <form id="areaform" method="post" action="/ajax.php?action=member&moduleid=2&job=saveinfo&field=address" class="info-from">
                    <div style="display:none" id="area2" class="info-list clearfix">
                        <label class="name fl">通讯地址 :</label>
                        <?php echo ajax_area_select('areaid', '请选择', $info['areaid'],'class="area-sel fl"');?>
                        <input type="text" maxlength="50" name="address" class="fl">
                        <input num="3" type="submit" value="保存" class="info-sub-x white">
                    </div>
                </form>
            </section>
        </section>
    </section>
</section>
<link rel="styleSheet" href="{DT_SKIN}js/layer/skin/layer.css">
<script src="{DT_SKIN}js/layer/layer.js"></script>
<script src="{DT_SKIN}js/Validform_v5.3.2_min.js"></script>
<script src="{DT_SKIN}js/send.js" type="text/javascript"></script>
<script>
    $("#idcardfrom").Validform({
        tiptype: 3,
        ajaxPost:true,
        datatype:{
            "is_idcard":function(gets,obj,curform,regxp){
                if(!is_idcard(gets)) return '输入错误';
                return true;
            }
        },
        callback:function(data){
            if(data.status=='y'){
                location.reload();
            }else{
                layer.msg(data.info);
            }
        }
    })

    $("#genderfrom").Validform({
        tiptype: 3,
        ajaxPost:true,
        callback:function(data){
            if(data.status=='y'){
                location.reload();
            }else{
                layer.msg(data.info);
            }
        }
    })

    function area(){
        document.getElementById('area2').style.display="";
        document.getElementById('area1').style.display="none"
    }
    $("#areaform").Validform({
        tiptype: 3,
        ajaxPost:true,
        callback:function(data){
            if(data.status=='y'){
                location.reload();
            }else{
                layer.msg(data.info);
            }
        }
    })

    function emailform(){
        document.getElementById('emailform23').style.display="none";
        document.getElementById('emailform').style.display="";
    }

    $("#emailform").Validform({
        tiptype: 3,
        ajaxPost:true,
        callback:function(data){
            if(data.status=='y'){
                location.reload();
            }else{
                layer.msg(data.info);
            }
        }
    })


    //弹出框集合
    function openPhoneNumber (d) {
        var cont = '<form id="openPhoneNumber" action="/ajax.php?action=member&moduleid=2&job=saveinfo&field=mobile"><div class="clearfix"  style="height:60px;"><span style="float:left;width: 94px;text-align: right;">'+
                '绑定手机：</span><input type="text" value="'+d+'" class="mobile" id="mobile" name="mobile" datatype="mobile"/><br /><span class="Validform_checktip" style="font-size:12px;line-height:22px;height:22px;margin-left:238px;"></span></div>' +
                '<div class="clearfix" style="height:60px;"><span style="float:left;width: 94px;text-align: right;">验证码：</span><input style="width:108px;" type="text" datatype="n6-6" name="code" /><button type="button" class="getCode send_mobile_to" onclick="send_mobile_to(this,3)"  id="check-btn" disabled>获取验证码</button><br /><span class="Validform_checktip" style="font-size:12px;line-height:22px;height:22px;width:238px;"></span></div>' +
                '<div class="clearfix"><span style="float:left;width: 94px;text-align: right; height: 28px;"></span><input type="submit" value="提交"/></div></form>';

        layer.open({
            title: '更换手机',
            closeBtn: 2,
            content: cont,
            area: ['500px', '270px'],
            btn: '',
            success: function () {

                $('#openPhoneNumber').Validform({
                    tiptype: 3,
                    datatype:{
                        "mobile":function(gets,obj,curform,regxp){
                            var istrue = false;
                            $.ajax({
                                type:'post',
                                url:"/ajax.php?action=member&job=mobile&moduleid=2&param="+gets,
                                dataType:'json',
                                async:false,
                                success:function(data){
                                    if(data.status=='y'){
                                        istrue = true;
                                        getCodeStatus = getCodeStatus=='10' || getCodeStatus=='00'?'01':getCodeStatus;
                                        $("#check-btn").removeAttr("disabled");
                                    }else{
                                        istrue = data.info;
                                    }
                                }
                            })
                            return istrue;
                        }
                    },
                    ajaxPost: true,
                    callback: function (data) {
                        if(data.status=='y'){
                            $(".layui-layer-close").click();
                        }
                        layer.msg(data.info);
                    }
                })
                $("#mobile").blur();
            }
        });
    }
</script>
{template 'footer','member'}